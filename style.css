 :root { color-scheme: light dark; }
    html, body { height: 100%; margin: 0; }
    body { font-family: 'Noto Sans JP', system-ui, -apple-system, Segoe UI, Roboto, 'Yu Gothic', sans-serif; }
    
    /* --- Opening Splash --- */
    .splash {
      position: fixed; inset: 0; z-index: 9999;
      display: grid; place-items: center;
      background: linear-gradient(135deg, #10131a 0%, #1a2333 60%, #0b1220 100%);
      color: #fff;
      overflow: hidden;
      transition: opacity .6s ease, visibility .6s step-end;
    }
    .splash.is-hidden { opacity: 0; visibility: hidden; }
    .splash__decor {
      position: absolute; inset: -20% -20% auto auto; width: 60vmax; height: 60vmax; pointer-events: none; opacity: .22;
      filter: blur(20px) saturate(120%);
      background: radial-gradient(closest-side, #2b7bff, transparent 70%),
                  radial-gradient(closest-side, #ff9f1a, transparent 70%),
                  radial-gradient(closest-side, #7a5cff, transparent 70%);
      background-position: 20% 30%, 60% 40%, 80% 70%;
      background-size: 40% 40%, 45% 45%, 35% 35%;
      animation: drift 12s ease-in-out infinite alternate;
    }
    @keyframes drift { from { transform: translate3d(0,0,0) rotate(0deg) } to { transform: translate3d(-4%,3%,0) rotate(12deg) } }
    .splash__ring {
      position: absolute; width: 38vmin; height: 38vmin; border-radius: 50%;
      box-shadow: 0 0 0 1px rgba(255,255,255,.08) inset, 0 0 60px rgba(123,163,255,.25);
      animation: pulse 2.4s ease-in-out infinite;
    }
    .splash__ring::before, .splash__ring::after{
      content: ""; position: absolute; inset: -18px; border-radius: 50%;
      border: 2px solid rgba(255,255,255,.08);
      animation: pulse 2.4s ease-in-out infinite;
      animation-delay: .2s;
    }
    @keyframes pulse { 0%,100% { transform: scale(.92); opacity: .7 } 50% { transform: scale(1.06); opacity: 1 } }
    .splash__logo {
      position: relative; display: grid; place-items: center; gap: 12px;
      text-align: center;
    }
    .splash__mark {
      width: 96px; height: 96px; border-radius: 24px;
      background: conic-gradient(from 0deg, #2b7bff, #7a5cff 40%, #ff9f1a 80%, #2b7bff 100%);
      box-shadow: 0 10px 30px rgba(43,123,255,.35), inset 0 0 24px rgba(255,255,255,.15);
      display: grid; place-items: center;
      animation: spin 8s linear infinite;
    }
    .splash__mark-inner{
      width: 64px; height: 64px; border-radius: 50%; background: #0b1220;
      display: grid; place-items: center;
    }
    .splash__logo-svg{ width: 48px; height: 48px; display:block; }
    .splash__logo-svg path{ fill: none; stroke: #ffd27a; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; filter: drop-shadow(0 0 6px rgba(255,210,122,.35));
      stroke-dasharray: 140; stroke-dashoffset: 140; animation: dash 2.6s ease-in-out forwards; }
    @keyframes dash { 0% { stroke-dashoffset: 140 } 60% { stroke-dashoffset: 0 } 100% { stroke-dashoffset: 0 } }
    @keyframes spin { to { transform: rotate(360deg) } }
    .splash__title { font-weight: 600; letter-spacing: .04em; font-size: 18px; }
    .splash__title span{
      background: linear-gradient(90deg, #9db8ff, #ffffff, #9db8ff);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      background-size: 200% 100%; animation: shimmer 2.8s ease-in-out infinite;
    }
    @keyframes shimmer { 0% { background-position: 200% 0 } 100% { background-position: -200% 0 } }
    .splash__hint { font-size: 12px; opacity: .7 }
    @media (prefers-reduced-motion: reduce){
      .splash__decor, .splash__ring, .splash__mark, .splash__quake, .splash__title span{ animation: none !important }
    }
  .layout { --panel-w: 360px; display: grid; grid-template-columns: var(--panel-w) 1fr; grid-template-rows: auto 1fr; grid-template-areas: 'header header' 'panel map'; height: 100%; transition: grid-template-columns .35s ease; }
  header { grid-area: header; padding: 10px 14px; border-bottom: 1px solid #ccc; background: #fff; }
  .panel { grid-area: panel; padding: 12px; border-right: 1px solid #ccc; overflow: auto; background: #fff; }
    .map { grid-area: map; }
    #map { width: 100%; height: 100%; }
    .box { background: #fff; border: 1px solid #ccc; border-radius: 10px; padding: 10px; margin-bottom: 12px; box-shadow: 0 1px 2px rgba(0,0,0,.06); }
    .box h3 { margin: 0 0 8px; font-size: 16px; }
    .row { display: flex; gap: 8px; align-items: center; }
    .row > * { flex: 1; }
    .small { font-size: 12px; color: #666; }
    .list { max-height: 42vh; overflow: auto; padding: 0; margin: 0; list-style: none; }
    .item { padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; }
    .item:hover { background: #f7f7f7; }
    .tag { display: inline-block; font-size: 11px; padding: 1px 6px; border-radius: 12px; border: 1px solid #bbb; margin-left: 6px; }
    .tag.shallow { background: #e7f0ff; border-color: #6aa4ff; }
    .tag.intermediate { background: #fff1dc; border-color: #ffb957; }
    .tag.deep { background: #efe6ff; border-color: #a88bff; }
    .controls label { font-size: 13px; display: block; }
    .muted { opacity: .55; }
    /* custom marker ui */
    .btn { padding: 8px 10px; border-radius: 8px; border: 1px solid #999; background: #fff; cursor: pointer; font-size: 12px; }
    .btn.primary { background: #2b7bff; border-color: #2b7bff; color: #fff; }
    .btn.danger { background: #ff4d4f; border-color: #ff4d4f; color: #fff; }
    .btn:disabled { opacity: .55; cursor: not-allowed; }
    input[type="text"], textarea, select { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #bbb; box-sizing: border-box; font-family: inherit; font-size: 13px; }
    textarea { resize: vertical; min-height: 60px; }
    .cm-dot { width: 16px; height: 16px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 0 0 1px rgba(0,0,0,.3); }
    #mkList .item { display: flex; flex-direction: column; gap: 2px; }
    #mkList .item.active { background: #f0f6ff; }
  /* collapse layout (animated via CSS variable) */
  .layout.collapsed { --panel-w: 56px; }
  .panel { transition: padding .35s ease; }
  .layout.collapsed .panel { padding: 8px; }
  .layout.collapsed .panel .box:not(.panel-tools) { display: none; }
    /* icon button */
    .icon-btn { width: 32px; height: 32px; display: inline-flex; align-items: center; justify-content: center; border-radius: 999px; border: 1px solid #999; background: #fff; cursor: pointer; }
    .icon { width: 18px; height: 18px; display: block; }
    /* panel tools (no box chrome) */
    .panel-tools { display: flex; justify-content: flex-end; padding: 0; margin: 0 0 8px 0; background: transparent; border: 0; box-shadow: none; }
    
   /* --- Map cursor behavior override --- */
   /* Default hover over map: arrow */
   #map.leaflet-container, #map.leaflet-grab, .leaflet-container, .leaflet-grab { cursor: default !important; }
   /* While dragging the map: show grab */
   .leaflet-dragging #map.leaflet-container,
   .leaflet-dragging #map.leaflet-grab,
   .leaflet-dragging .leaflet-container,
  .leaflet-dragging .leaflet-grab { cursor: grab !important; }

  /* --- Country images gallery --- */
  .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(96px, 1fr)); gap: 8px; }
  .gallery img { width: 100%; height: 80px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd; background: #f7f7f7; }
  .gallery .thumb { position: relative; overflow: hidden; border-radius: 8px; }
  .gallery .thumb::after { content: ""; position: absolute; inset: 0; box-shadow: inset 0 0 0 1px rgba(0,0,0,.08); border-radius: 8px; pointer-events: none; }

  /* ---- Alert toasts ---- */
  .alerts { position: fixed; z-index: 5000; right: 16px; top: 16px; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
  .alert-card { pointer-events: auto; display: grid; grid-template-columns: auto 1fr auto; gap: 10px; align-items: center; background: #fff; color:#111; border: 1px solid #ddd; border-radius: 10px; padding: 10px 12px; box-shadow: 0 6px 20px rgba(0,0,0,.12); overflow: hidden; }
  .alert-card .alert-badge { min-width: 56px; height: 56px; border-radius: 10px; display: grid; place-items: center; font-weight: 700; color:#fff; }
  .alert-card .alert-body { min-width: 160px; }
  .alert-card .alert-title { font-weight: 600; margin-bottom: 2px; }
  .alert-card .alert-meta { opacity: .75; }
  .alert-card .alert-action { border: 1px solid #888; background:#fff; color:#111; border-radius: 8px; padding: 6px 10px; cursor: pointer; }
  .alert-card .alert-action:hover { background: #f5f5f5; }
  .alert-card.light .alert-badge { background: #2b7bff; }
  .alert-card.medium .alert-badge { background: #ff9f1a; }
  .alert-card.strong .alert-badge { background: #ff4d4f; animation: shake .5s ease-in-out 2; }
  @keyframes shake { 0%,100%{ transform: translateX(0)} 25%{ transform: translateX(-3px)} 75%{ transform: translateX(3px)} }
  .alert-enter { animation: slideIn .35s ease, glow 1.2s ease-in-out; }
  @keyframes slideIn { from{ transform: translateY(-10px); opacity: 0 } to { transform: translateY(0); opacity: 1 } }
  @keyframes glow { 0% { box-shadow: 0 0 0 0 rgba(255,77,79,.0) } 30% { box-shadow: 0 0 0 6px rgba(255,77,79,.12) } 100% { box-shadow: 0 6px 20px rgba(0,0,0,.12) } }